// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider        = "prisma-client-js"
    previewFeatures = ["interactiveTransactions"]
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model Project {
    id   String @id
    displayId String?
    name String?

    schedule ScheduleItem[]
    timeline TimelineItem[] @relation(name: "projectTimeline")

    tasks ProjectTask[] @relation(name: "projectTasks")

    organisation String

    startDate DateTime?
    endDate   DateTime?
    status    String

    @@unique([organisation, displayId])
}

model ProjectTask {
    id String @id

    title String
    description String?

    status String?

    project Project @relation(name: "projectTasks", fields: [projectId], references: [id])
    projectId String

    startDate DateTime?
    endDate   DateTime?

    dependencyOf ProjectTask[] @relation(name: "dependencyOf")
    dependencyOn ProjectTask[] @relation(name: "dependencyOf")

    @@unique([projectId, id])
}

model Estimate {
    id           String   @id
    displayId    String? 
    
    name         String?
    status       String?

    date        DateTime?

    companyName  String?

    createdAt    DateTime @default(now())
    updatedAt    DateTime @default(now())

    price        Float?
    
    organisation String

    timeline TimelineItem[] @relation(name: "estimateTimeline")

    @@unique([ displayId, organisation ])
}

model Equipment {
    id           String @id
    displayId    String?
    name         String?
    registration String?

    schedule ScheduleItem[] @relation(name: "scheduleEquipment")

    organisation String

    @@unique([ displayId, organisation ])
}

model ScheduleItem {
    id String @id

    date      DateTime
    project   Project  @relation(fields: [projectId], references: [id])
    projectId String

    people String[]
    equipment Equipment[] @relation(name: "scheduleEquipment")

    notes  String[]

	permissions ScheduleItemPermission[] @relation(name: "permissionsFor")

    owner String?

    createdAt DateTime @default(now())

    organisation String
}

model ScheduleItemPermission {
	id String @id

	owner String

	createdAt DateTime @default(now())

	scheduleItem ScheduleItem @relation(name: "permissionsFor", fields: [scheduleItemId], references: [id])
	scheduleItemId String

	@@unique([owner, scheduleItemId], name: "schedulePermitted")
}

// model Timeline {
// 	id String @id
// 	name String 

//     resources String[]

// 	items TimelineItem[] @relation("onTimeline")

// 	organisation String
// }

model TimelineItem {
	id String @id

    estimate Estimate? @relation(name: "estimateTimeline", fields: [estimateId], references: [id])
    estimateId String?

    project Project? @relation(name: "projectTimeline", fields: [projectId], references: [id])
    projectId String?

    data Json?

	notes String?

	startDate DateTime
	endDate DateTime

    timeline String

    organisation String?
	// timeline Timeline @relation(name: "onTimeline", fields: [timelineId], references: [id], onDelete: Cascade)
	// timelineId String
}
// model TimelineItem {
// 	id String @id

//   timeline String
// 	startDate DateTime
// 	endDate DateTime
// 	notes String
// 	items TimelineItemItems[]
//   projectId String
// 	organisation String
// }

// model TimelineItemItems {
//   id String @id
//   name String
//   startDate DateTime
//   endDate DateTime
//   notes String
//   timelineItem TimelineItem @relation(fields: [timelineItemId], references: [id])
//   timelineItemId String
//   organisation String
// }
